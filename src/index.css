/* src/index.css */
/* ------------------------------------------------------------
   Tailwind base
   ------------------------------------------------------------ */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ------------------------------------------------------------
   Base accent tokens (picked by .theme-*)
   ------------------------------------------------------------ */
:root {
  --_accent-50:  #eef2ff;
  --_accent-100:#e0e7ff;
  --_accent-200:#c7d2fe;
  --_accent-300:#a5b4fc;
  --_accent-400:#818cf8;
  --_accent-500:#6366f1;
  --_accent-600:#4f46e5;
  --_accent-700:#4338ca;
  --_accent-800:#3730a3;
  --_accent-900:#312e81;
  --_accent-on:#ffffff;
}

/* Emerald */ .theme-emerald { --_accent-50:#ecfdf5; --_accent-100:#d1fae5; --_accent-200:#a7f3d0; --_accent-300:#6ee7b7; --_accent-400:#34d399; --_accent-500:#10b981; --_accent-600:#059669; --_accent-700:#047857; --_accent-800:#065f46; --_accent-900:#064e3b; --_accent-on:#ffffff; }
/* Violet  */ .theme-violet  { --_accent-50:#f5f3ff; --_accent-100:#ede9fe; --_accent-200:#ddd6fe; --_accent-300:#c4b5fd; --_accent-400:#a78bfa; --_accent-500:#8b5cf6; --_accent-600:#7c3aed; --_accent-700:#6d28d9; --_accent-800:#5b21b6; --_accent-900:#4c1d95; --_accent-on:#ffffff; }
/* Amber   */ .theme-amber   { --_accent-50:#fffbeb; --_accent-100:#fef3c7; --_accent-200:#fde68a; --_accent-300:#fcd34d; --_accent-400:#fbbf24; --_accent-500:#f59e0b; --_accent-600:#d97706; --_accent-700:#b45309; --_accent-800:#92400e; --_accent-900:#78350f; --_accent-on:#111827; }
/* Rose    */ .theme-rose    { --_accent-50:#fff1f2; --_accent-100:#ffe4e6; --_accent-200:#fecdd3; --_accent-300:#fda4af; --_accent-400:#fb7185; --_accent-500:#f43f5e; --_accent-600:#e11d48; --_accent-700:#be123c; --_accent-800:#9f1239; --_accent-900:#881337; --_accent-on:#ffffff; }
/* Slate   */ .theme-slate   { --_accent-50:#f8fafc; --_accent-100:#f1f5f9; --_accent-200:#e2e8f0; --_accent-300:#cbd5e1; --_accent-400:#94a3b8; --_accent-500:#64748b; --_accent-600:#475569; --_accent-700:#334155; --_accent-800:#1e293b; --_accent-900:#0f172a; --_accent-on:#ffffff; }
/* Teal    */ .theme-teal    { --_accent-50:#f0fdfa; --_accent-100:#ccfbf1; --_accent-200:#99f6e4; --_accent-300:#5eead4; --_accent-400:#2dd4bf; --_accent-500:#14b8a6; --_accent-600:#0d9488; --_accent-700:#0f766e; --_accent-800:#115e59; --_accent-900:#134e4a; --_accent-on:#ffffff; }
/* Indigo  */ .theme-indigo  { --_accent-50:#eef2ff; --_accent-100:#e0e7ff; --_accent-200:#c7d2fe; --_accent-300:#a5b4fc; --_accent-400:#818cf8; --_accent-500:#6366f1; --_accent-600:#4f46e5; --_accent-700:#4338ca; --_accent-800:#3730a3; --_accent-900:#312e81; --_accent-on:#ffffff; }
/* Sky     */ .theme-sky     { --_accent-50:#f0f9ff; --_accent-100:#e0f2fe; --_accent-200:#bae6fd; --_accent-300:#7dd3fc; --_accent-400:#38bdf8; --_accent-500:#0ea5e9; --_accent-600:#0284c7; --_accent-700:#0369a1; --_accent-800:#075985; --_accent-900:#0c4a6e; --_accent-on:#ffffff; }

/* ------------------------------------------------------------
   Accent-aware UI bits
   ------------------------------------------------------------ */
@layer components {
  .chip {
    @apply inline-flex items-center gap-2 rounded-full text-sm font-medium select-none px-3 py-1 border transition-colors;
    background-color: rgba(0,0,0,0.03);
    border-color: rgba(0,0,0,0.1);
    color: inherit;
  }
  .dark .chip {
    background-color: rgba(255,255,255,0.06);
    border-color: rgba(255,255,255,0.16);
    color: #e5e7eb;
  }
  .chip:hover { background-color: rgba(0,0,0,0.06); }
  .dark .chip:hover { background-color: rgba(255,255,255,0.10); }

  /* PRIMARY selected-state hooks (now forced to win cascade) */
  .chip--active,
  .chip[aria-selected="true"],
  .chip[data-active="true"],
  .chip[aria-pressed="true"],
  [role="tab"].chip[aria-selected="true"] {
    background-color: var(--_accent-600) !important;
    border-color: var(--_accent-600) !important;
    color: var(--_accent-on) !important;
  }

  /* GENERIC selected-state hooks (for components we don't control) */
  button[aria-pressed="true"],
  [role="tab"][aria-selected="true"],
  .active, .is-active, .selected, .pill.active, .pill.is-active,
  label:has(input[type="checkbox"]:checked),
  label:has(input[type="radio"]:checked) {
    background-color: var(--_accent-600) !important;
    border-color: var(--_accent-600) !important;
    color: var(--_accent-on) !important;
  }

  .chip--active:hover,
  .chip[aria-selected="true"]:hover,
  .chip[data-active="true"]:hover,
  .chip[aria-pressed="true"]:hover,
  [role="tab"].chip[aria-selected="true"]:hover,
  button[aria-pressed="true"]:hover,
  [role="tab"][aria-selected="true"]:hover,
  .active:hover, .is-active:hover, .selected:hover, .pill.active:hover, .pill.is-active:hover,
  label:has(input[type="checkbox"]:checked):hover,
  label:has(input[type="radio"]:checked):hover {
    background-color: var(--_accent-700, var(--_accent-600)) !important;
    border-color: var(--_accent-700, var(--_accent-600)) !important;
    color: var(--_accent-on) !important;
  }

  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-lg text-sm font-medium px-3.5 py-2.5 border transition-colors;
    background-color: rgba(0,0,0,0.03);
    border-color: rgba(0,0,0,0.1);
    color: inherit;
  }
  .dark .btn { background-color: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.16); color: #e5e7eb; }
  .btn:hover { background-color: rgba(0,0,0,0.06); }
  .dark .btn:hover { background-color: rgba(255,255,255,0.08); }

  .btn-accent {
    background-color: var(--_accent-600);
    border-color: var(--_accent-600);
    color: var(--_accent-on);
  }
  .btn-accent:hover {
    background-color: var(--_accent-700, var(--_accent-600));
    border-color: var(--_accent-700, var(--_accent-600));
  }

  .btn-outline {
    background-color: transparent;
    border-color: var(--_accent-600);
    color: var(--_accent-700, var(--_accent-600));
  }
  .btn-outline:hover { background-color: rgba(0,0,0,0.04); }
  .dark .btn-outline:hover { background-color: rgba(255,255,255,0.08); }

  .accent-bg { background-color: var(--_accent-600); color: var(--_accent-on); }
  .accent-bg:hover { background-color: var(--_accent-700, var(--_accent-600)); }
  .accent-text { color: var(--_accent-600); }

  .btn:disabled, .chip:disabled { opacity: 0.55; cursor: not-allowed; }

  /* High-visibility keyboard focus */
  .btn:focus-visible, .chip:focus-visible, .accent-bg:focus-visible,
  [role="tab"].chip:focus-visible,
  button[aria-pressed="true"]:focus-visible,
  [role="tab"][aria-selected="true"]:focus-visible {
    outline: 2px solid var(--_accent-600); outline-offset: 2px;
  }
}

@media (prefers-reduced-motion: reduce) {
  .btn, .chip { transition: none !important; }
}

/* ============================================================
   CHAOTIC â€“ FULL THEME BACKGROUND (decoupled from accent)
   ============================================================ */
html.bg-chaotic, html.theme-chaotic { min-height: 100%; }
html.bg-chaotic body, html.theme-chaotic body {
  background-color: #0b0d16;

  /* Fallback for browsers without image-set, or if you override --cn-chaotic-bg-url */
  background-image: var(--cn-chaotic-bg-url, url("/themes/chaotic/mountains.jpg"));

  /* Prefer WebP if supported; this overrides the line above when valid */
  background-image: var(--cn-chaotic-bg, image-set(
    url("/themes/chaotic/mountains.webp") type("image/webp") 1x,
    url("/themes/chaotic/mountains.jpg")  type("image/jpeg") 1x
  ));

  background-size: cover;
  background-position: center 42%;
  background-repeat: no-repeat;
  background-attachment: fixed;
}
@supports (-webkit-touch-callout: none) {
  html.bg-chaotic body, html.theme-chaotic body { background-attachment: scroll; }
}

/* Veil / glow */
html.bg-chaotic:not(.dark) body::before,
html.theme-chaotic:not(.dark) body::before {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    linear-gradient(to top, rgba(11,13,22,0.40) 0%, rgba(11,13,22,0.24) 38%, rgba(11,13,22,0.12) 100%),
    radial-gradient(60% 40% at 85% -10%, rgba(76,201,240,0.10), transparent 70%),
    radial-gradient(60% 40% at 10% 110%, rgba(79,104,232,0.12), transparent 70%);
}
html.bg-chaotic.dark body::before,
html.theme-chaotic.dark body::before {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background:
    linear-gradient(to top, rgba(7,8,14,0.92) 0%, rgba(7,8,14,0.72) 45%, rgba(7,8,14,0.50) 100%),
    radial-gradient(60% 40% at 85% -10%, rgba(76, 201, 240, 0.10), transparent 70%),
    radial-gradient(60% 40% at 10% 110%, rgba(79, 104, 232, 0.12), transparent 70%);
}

/* Light panel transparency on chaotic */
html.bg-chaotic:not(.dark) .bg-white,
html.bg-chaotic:not(.dark) .bg-zinc-50,
html.bg-chaotic:not(.dark) .bg-zinc-100 {
  background-color: rgba(255,255,255,0.40) !important;
  backdrop-filter: blur(1px);
  -webkit-backdrop-filter: blur(1px);
  box-shadow: 0 1px 0 rgba(0,0,0,.03) inset, 0 10px 28px rgba(0,0,0,.10);
}

/* Header transparency */
html.bg-chaotic:not(.dark) header {
  background-color: rgba(255,255,255,0.36) !important;
  backdrop-filter: blur(1px);
  -webkit-backdrop-filter: blur(1px);
}

/* Dark surfaces transparent to show scene */
html.bg-chaotic.dark .bg-zinc-900,
html.bg-chaotic.dark .bg-zinc-950 { background-color: transparent !important; }

/* Watermark */
html.bg-chaotic body::after,
html.theme-chaotic body::after {
  content: ""; position: fixed; top: 2.5rem; left: 2.5rem;
  width: 128px; height: 128px;
  background: url("/themes/chaotic/logo.svg") no-repeat center / contain;
  opacity: 0.05; filter: saturate(1.05); pointer-events: none; z-index: 0;
}

/* Content above overlays */
html.bg-chaotic #root, html.theme-chaotic #root { position: relative; z-index: 1; }

/* Let the background show through main wrappers */
html.bg-chaotic .min-h-screen,
html.bg-chaotic .page,
html.bg-chaotic .app-shell { background: transparent !important; }

/* ============================================================
   Dark-mode select/option readability (minimal + scoped broadly)
   Ensures high-contrast menus when the native <select> opens.
   ============================================================ */
.dark select {
  color-scheme: dark;            /* Hint to UA for dark popups */
  background-color: #0f172a;     /* slate-900 */
  color: #e5e7eb;                /* zinc-200 */
  border-color: #374151;         /* gray-700 */
}
.dark select:focus-visible { outline-color: var(--_accent-600); }
.dark option, .dark optgroup {
  background-color: #0f172a;     /* ensure the dropdown list is dark */
  color: #e5e7eb;
}

/* ============================================================
   CNM Modal Lock & Single-Scroll Overlay (class-based)
   - Add 'modal-open' to html, body, and #root while any modal is open.
   - Background (page) becomes non-scrollable.
   - The overlay is the ONLY scroll container (single scrollbar).
   ============================================================ */
html.modal-open,
body.modal-open,
#root.modal-open {
  overflow: hidden !important;
}

/* These utility classes can be applied to your modal overlay/content.
   If your component already has different class names, keep using them;
   these are provided so we can centralize the scroll behavior in CSS. */
.modal-overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 2.5rem 1rem;
  background: rgba(0,0,0,0.40);
  z-index: 1000;
  overflow: auto;                /* single scrollbar lives here */
}

/* Prevent nested scrollbars inside the modal content */
.modal-overlay .modal-scroll {
  width: min(100%, 980px);
  max-height: none !important;   /* let content grow; overlay handles scroll */
  overflow: visible !important;  /* avoid an inner scrollbar */
}
